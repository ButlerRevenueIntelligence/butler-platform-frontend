<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Butler & Co Revenue Intelligence Platform</title>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- PropTypes (required by Recharts UMD sometimes) -->
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

  <!-- Recharts -->
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/umd/Recharts.min.js"></script>

  <!-- Babel (for in-browser JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #0A0E1A 0%, #1A1F2E 100%);
      color: #fff;
      min-height: 100vh;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      flex-direction: column;
      gap: 20px;
    }
    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 71, 255, 0.1);
      border-top: 4px solid #0047FF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    button { cursor: pointer; font-family: inherit; }
    input { font-family: inherit; }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const {
      AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
      PieChart, Pie, Cell
    } = Recharts;

    // =========================
    // CONFIG
    // =========================
    const API_URL = 'https://butler-platform-backend.onrender.com/api/v1';

    // =========================
    // DEMO DATA (MATCHES UI KEYS)
    // =========================
    const DEMO_REVENUE = {
      total_revenue: 295422,
      mrr: 25109,
      arr: 301304,
      previous_period_revenue: 220000,
      growth_rate: 0.34,
      by_period: [
        { period_start: "Jan", revenue: 52000 },
        { period_start: "Feb", revenue: 56000 },
        { period_start: "Mar", revenue: 60000 },
        { period_start: "Apr", revenue: 64000 },
        { period_start: "May", revenue: 68000 },
        { period_start: "Jun", revenue: 72000 },
      ],
      by_source: [
        { source: "SEO", revenue: 127000, percentage: 43 },
        { source: "Paid Ads", revenue: 44300, percentage: 15 },
        { source: "Direct", revenue: 53600, percentage: 18 },
        { source: "Referrals", revenue: 70500, percentage: 24 },
      ],
    };

    const DEMO_INSIGHTS = [
      { id: 1, type: "opportunity", impact: "HIGH", confidence: 92, title: "SEO is driving strongest ROI", description: "Organic search contributes the largest share of revenue. Scale content + technical fixes to push incremental MRR." },
      { id: 2, type: "warning", impact: "MED", confidence: 81, title: "Paid Ads efficiency plateau", description: "Paid spend is steady but marginal returns are flattening. Refresh creatives and tighten audiences to protect CAC." },
      { id: 3, type: "success", impact: "HIGH", confidence: 88, title: "Referral channel accelerating", description: "Referral revenue is growing faster than baseline. Introduce partner incentives and track lead-to-close velocity." },
    ];

    const DEFAULT_CLIENTS = [
      { id: 1, company_name: "TechCorp Industries", industry: "IT Services", status: "active", mrr: 12500, health_score: 92 },
      { id: 2, company_name: "ProManufacture Co", industry: "Manufacturing", status: "active", mrr: 8600, health_score: 88 },
      { id: 3, company_name: "Commerce Law Partners", industry: "Professional Services", status: "active", mrr: 5400, health_score: 85 },
    ];

    function loadClientsFromStorage() {
      try {
        const saved = localStorage.getItem("butler_demo_clients");
        return saved ? JSON.parse(saved) : DEFAULT_CLIENTS;
      } catch {
        return DEFAULT_CLIENTS;
      }
    }
    function saveClientsToStorage(clients) {
      localStorage.setItem("butler_demo_clients", JSON.stringify(clients));
    }

    // =========================
    // API Helper
    // =========================
    const api = {
      async login(email, password) {
        const response = await fetch(`${API_URL}/auth/token`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password }),
        });
        if (!response.ok) throw new Error('Login failed');
        return response.json();
      },

      async get(endpoint, token) {
        const response = await fetch(`${API_URL}${endpoint}`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        });
        if (!response.ok) throw new Error('API request failed');
        return response.json();
      },

      async post(endpoint, data, token) {
        const response = await fetch(`${API_URL}${endpoint}`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });
        if (!response.ok) throw new Error('API request failed');
        return response.json();
      },
    };

    // =========================
    // Login Component
    // =========================
    function LoginPage({ onLogin }) {
      const [email, setEmail] = useState('demo@butlerco.com');
      const [password, setPassword] = useState('demo123');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');
        try {
          const data = await api.login(email, password);
          onLogin(data.access_token, data.user || { email, firstName: "Demo" });
        } catch (err) {
          setError('Invalid credentials. Try demo@butlerco.com / demo123');
        } finally {
          setLoading(false);
        }
      };

      return (
        <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
          <div style={{ maxWidth: '420px', width: '100%', background: 'rgba(255,255,255,0.03)', padding: '40px', borderRadius: '16px', border: '1px solid rgba(255,255,255,0.1)' }}>
            <div style={{ textAlign: 'center', marginBottom: '28px' }}>
              <div style={{ width: '60px', height: '60px', background: 'linear-gradient(135deg, #0047FF, #00D9FF)', borderRadius: '12px', margin: '0 auto 16px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '28px' }}>ðŸ“Š</div>
              <h1 style={{ fontSize: '24px', marginBottom: '8px' }}>Butler & Co</h1>
              <p style={{ color: '#8B92A8', fontSize: '14px' }}>Revenue Intelligence Platform</p>
            </div>

            {error && (
              <div style={{ background: 'rgba(255,51,102,0.1)', border: '1px solid #FF3366', padding: '12px', borderRadius: '8px', marginBottom: '18px', fontSize: '14px' }}>
                {error}
              </div>
            )}

            <form onSubmit={handleSubmit}>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', color: '#8B92A8' }}>Email</label>
                <input
                  type="email"
                  autoComplete="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  style={{ width: '100%', padding: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px', color: '#fff', fontSize: '14px' }}
                  required
                />
              </div>

              <div style={{ marginBottom: '22px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', color: '#8B92A8' }}>Password</label>
                <input
                  type="password"
                  autoComplete="current-password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  style={{ width: '100%', padding: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px', color: '#fff', fontSize: '14px' }}
                  required
                />
              </div>

              <button
                type="submit"
                disabled={loading}
                style={{ width: '100%', padding: '14px', background: 'linear-gradient(135deg, #0047FF, #00D9FF)', border: 'none', borderRadius: '8px', color: '#fff', fontSize: '16px', fontWeight: 700, opacity: loading ? 0.7 : 1 }}
              >
                {loading ? 'Signing in...' : 'Sign In'}
              </button>
            </form>

            <div style={{ marginTop: '18px', padding: '14px', background: 'rgba(0,217,255,0.05)', border: '1px solid rgba(0,217,255,0.2)', borderRadius: '8px', fontSize: '12px', color: '#8B92A8' }}>
              <strong style={{ color: '#00D9FF' }}>Demo Account:</strong><br />
              Email: demo@butlerco.com<br />
              Password: demo123
            </div>
          </div>
        </div>
      );
    }

    // =========================
    // Dashboard
    // =========================
    function Dashboard({ token, user, onLogout }) {
      const [activeView, setActiveView] = useState('overview');
      const [loading, setLoading] = useState(true);

      // Demo/Live toggle
      const [mode, setMode] = useState(localStorage.getItem("butler_mode") || "demo");

      // Data
      const [revenueData, setRevenueData] = useState(null);
      const [insights, setInsights] = useState([]);
      const [clients, setClients] = useState(loadClientsFromStorage());

      // Persist clients for demo mode
      useEffect(() => { saveClientsToStorage(clients); }, [clients]);

      // Persist mode
      useEffect(() => { localStorage.setItem("butler_mode", mode); }, [mode]);

      const isDemo = mode === "demo";

      useEffect(() => { loadData(); }, [mode]);

      const loadData = async () => {
        setLoading(true);
        try {
          if (isDemo) {
            setRevenueData(DEMO_REVENUE);
            setInsights(DEMO_INSIGHTS);
            setClients(loadClientsFromStorage());
            return;
          }

          // LIVE MODE: try API; if missing pieces, fallback to DEMO_REVENUE shape so UI never shows blank.
          const [revenue, insightsData, clientsData] = await Promise.allSettled([
            api.get('/revenue/summary', token),
            api.get('/insights/latest?limit=5', token),
            api.get('/clients', token),
          ]);

          const liveRevenueRaw = revenue.status === "fulfilled" ? revenue.value?.data : null;
          const liveInsightsRaw = insightsData.status === "fulfilled" ? insightsData.value?.data : null;
          const liveClientsRaw = clientsData.status === "fulfilled" ? clientsData.value?.data : null;

          // Normalize revenue keys so UI never shows $0 again
          const normalizedRevenue = normalizeRevenue(liveRevenueRaw);

          setRevenueData(normalizedRevenue);
          setInsights(Array.isArray(liveInsightsRaw?.insights) ? liveInsightsRaw.insights : DEMO_INSIGHTS);
          setClients(Array.isArray(liveClientsRaw) && liveClientsRaw.length ? liveClientsRaw : loadClientsFromStorage());

        } catch (err) {
          console.error("Load failed:", err);
          // Hard fallback
          setRevenueData(DEMO_REVENUE);
          setInsights(DEMO_INSIGHTS);
          setClients(loadClientsFromStorage());
        } finally {
          setLoading(false);
        }
      };

      const handleRefresh = () => loadData();

      const toggleMode = () => setMode((m) => (m === "demo" ? "live" : "demo"));

      if (loading) {
        return (
          <div className="loading">
            <div className="spinner"></div>
            <div>Loading platform data...</div>
          </div>
        );
      }

      return (
        <div style={{ padding: '24px', minHeight: '100vh' }}>
          {/* Header */}
          <div style={{ marginBottom: '20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: '12px', flexWrap: 'wrap' }}>
            <div>
              <h1 style={{ fontSize: '32px', marginBottom: '8px' }}>Revenue Intelligence Platform</h1>
              <p style={{ color: '#8B92A8' }}>Welcome back, {user?.firstName || user?.email || "Demo"}</p>
            </div>

            <div style={{ display: 'flex', gap: '10px', alignItems: 'center', flexWrap: 'wrap' }}>
              <span style={{
                padding: '8px 12px',
                borderRadius: '999px',
                border: '1px solid rgba(255,255,255,0.12)',
                background: isDemo ? 'rgba(0,217,255,0.10)' : 'rgba(0,255,136,0.10)',
                color: isDemo ? '#00D9FF' : '#00FF88',
                fontSize: '12px',
                fontWeight: 800,
                letterSpacing: '0.5px'
              }}>
                {isDemo ? "DEMO MODE" : "LIVE MODE"}
              </span>

              <button
                onClick={handleRefresh}
                style={{ padding: '10px 14px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '10px', color: '#fff', fontSize: '14px', fontWeight: 700 }}
              >
                â†» Refresh
              </button>

              <button
                onClick={toggleMode}
                style={{ padding: '10px 14px', background: 'rgba(0,71,255,0.12)', border: '1px solid rgba(0,71,255,0.35)', borderRadius: '10px', color: '#fff', fontSize: '14px', fontWeight: 800 }}
              >
                {isDemo ? "Switch to Live" : "Switch to Demo"}
              </button>

              <button
                onClick={onLogout}
                style={{ padding: '10px 14px', background: 'rgba(255,51,102,0.12)', border: '1px solid rgba(255,51,102,0.35)', borderRadius: '10px', color: '#FF3366', fontSize: '14px', fontWeight: 800 }}
              >
                Sign Out
              </button>
            </div>
          </div>

          {/* Navigation */}
          <div style={{ borderBottom: '1px solid rgba(255,255,255,0.1)', marginBottom: '22px', display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
            {['overview', 'insights', 'clients'].map(view => (
              <button
                key={view}
                onClick={() => setActiveView(view)}
                style={{
                  padding: '12px 18px',
                  background: activeView === view ? 'rgba(0,71,255,0.12)' : 'transparent',
                  border: '1px solid rgba(255,255,255,0.10)',
                  borderBottom: activeView === view ? '2px solid #0047FF' : '2px solid transparent',
                  borderRadius: '12px',
                  color: activeView === view ? '#EAF1FF' : '#8B92A8',
                  fontSize: '14px',
                  fontWeight: 800,
                  textTransform: 'capitalize'
                }}
              >
                {view}
              </button>
            ))}
          </div>

          {/* Content */}
          {activeView === 'overview' && (
            <OverviewView
              data={revenueData}
              apiUrl={API_URL}
              isDemo={isDemo}
            />
          )}
          {activeView === 'insights' && <InsightsView insights={insights} />}
          {activeView === 'clients' && <ClientsView clients={clients} />}
        </div>
      );
    }

    // =========================
    // Normalize Revenue (prevents $0 forever)
    // Accepts any backend shape and returns UI shape
    // =========================
    function normalizeRevenue(raw) {
      if (!raw || typeof raw !== "object") return DEMO_REVENUE;

      const total_revenue =
        numOrNull(raw.total_revenue) ??
        numOrNull(raw.totalRevenue) ??
        numOrNull(raw.total) ??
        DEMO_REVENUE.total_revenue;

      const mrr =
        numOrNull(raw.mrr) ??
        numOrNull(raw.monthly_recurring_revenue) ??
        numOrNull(raw.monthlyRecurringRevenue) ??
        DEMO_REVENUE.mrr;

      const arr =
        numOrNull(raw.arr) ??
        numOrNull(raw.annual_recurring_revenue) ??
        numOrNull(raw.annualRecurringRevenue) ??
        DEMO_REVENUE.arr;

      const previous_period_revenue =
        numOrNull(raw.previous_period_revenue) ??
        numOrNull(raw.previousPeriodRevenue) ??
        DEMO_REVENUE.previous_period_revenue;

      const growth_rate =
        numOrNull(raw.growth_rate) ??
        numOrNull(raw.growthRate) ??
        DEMO_REVENUE.growth_rate;

      const by_period =
        Array.isArray(raw.by_period) && raw.by_period.length ? raw.by_period :
        Array.isArray(raw.byPeriod) && raw.byPeriod.length ? raw.byPeriod :
        DEMO_REVENUE.by_period;

      const by_source =
        Array.isArray(raw.by_source) && raw.by_source.length ? raw.by_source :
        Array.isArray(raw.bySource) && raw.bySource.length ? raw.bySource :
        DEMO_REVENUE.by_source;

      return { total_revenue, mrr, arr, previous_period_revenue, growth_rate, by_period, by_source };
    }

    function numOrNull(v) {
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    // =========================
    // Overview View
    // =========================
    function OverviewView({ data, apiUrl, isDemo }) {
      const COLORS = ['#0047FF', '#00D9FF', '#00FF88', '#FFB800'];
      if (!data) return <div>No data available</div>;

      return (
        <div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: '12px', flexWrap: 'wrap', marginBottom: '18px' }}>
            <button
              onClick={() => alert(isDemo ? "Demo: Add Revenue Entry coming next (saves to browser)!" : "Live: wire this to backend POST /revenue/entry")}
              style={{
                padding: '12px 16px',
                background: 'linear-gradient(135deg, #0047FF, #00D9FF)',
                border: 'none',
                borderRadius: '12px',
                color: '#fff',
                fontSize: '14px',
                fontWeight: 900
              }}
            >
              + Add Revenue Entry
            </button>

            <div style={{ color: '#8B92A8', fontSize: '12px' }}>
              Tip: {isDemo ? "Demo mode saves changes in your browser (localStorage)." : "Live mode pulls from your backend."}
              <span style={{ marginLeft: '14px', color: '#8B92A8' }}>API: {apiUrl}</span>
            </div>
          </div>

          {/* KPI Cards */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(240px, 1fr))', gap: '16px', marginBottom: '22px' }}>
            <KpiCard
              label="Total Revenue"
              value={`$${Math.round(data.total_revenue || 0).toLocaleString()}`}
              sub="Executive snapshot"
              accent="#00FF88"
              foot={`â†— +${Math.round(((data.growth_rate || 0.34) * 100))}% vs last period`}
            />
            <KpiCard
              label="Monthly Recurring Revenue"
              value={`$${Math.round(data.mrr || 0).toLocaleString()}`}
              sub="Stability indicator"
              accent="#00FF88"
              foot="â†— Trending up"
            />
            <KpiCard
              label="Annual Recurring Revenue"
              value={`$${Math.round(data.arr || 0).toLocaleString()}`}
              sub="Projected run-rate"
              accent="#00D9FF"
              foot="Projected growth"
            />
            <KpiCard
              label="Growth Rate"
              value={data.growth_rate != null ? `${(data.growth_rate * 100).toFixed(1)}%` : '0.0%'}
              sub="Compared to previous period"
              accent="#00FF88"
              foot="Month over month"
            />
          </div>

          {/* Revenue Trend */}
          <div style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: '14px', padding: '18px', marginBottom: '18px' }}>
            <h3 style={{ marginBottom: '14px', fontSize: '18px' }}>Revenue Trend</h3>

            {Array.isArray(data.by_period) && data.by_period.length > 0 ? (
              <ResponsiveContainer width="100%" height={320}>
                <AreaChart data={data.by_period}>
                  <defs>
                    <linearGradient id="colorRevenue" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor="#00D9FF" stopOpacity={0.30} />
                      <stop offset="95%" stopColor="#00D9FF" stopOpacity={0.00} />
                    </linearGradient>
                  </defs>

                  <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.06)" />
                  <XAxis dataKey="period_start" stroke="#8B92A8" />
                  <YAxis stroke="#8B92A8" />
                  <Tooltip
                    contentStyle={{
                      background: 'rgba(10, 14, 26, 0.95)',
                      border: '1px solid rgba(255,255,255,0.10)',
                      borderRadius: '10px'
                    }}
                  />
                  <Area
                    type="monotone"
                    dataKey="revenue"
                    stroke="#00D9FF"
                    fill="url(#colorRevenue)"
                    isAnimationActive={true}
                    animationDuration={900}
                  />
                </AreaChart>
              </ResponsiveContainer>
            ) : (
              <div style={{ height: 320, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#8B92A8', border: '1px dashed rgba(255,255,255,0.12)', borderRadius: '12px' }}>
                No trend data yet.
              </div>
            )}
          </div>

          {/* Revenue by Source */}
          <div style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: '14px', padding: '18px' }}>
            <h3 style={{ marginBottom: '14px', fontSize: '18px' }}>Revenue by Source</h3>

            {Array.isArray(data.by_source) && data.by_source.length > 0 ? (
              <ResponsiveContainer width="100%" height={320}>
                <PieChart>
                  <Pie
                    data={data.by_source}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ source, percentage }) => `${source} ${percentage}%`}
                    outerRadius={110}
                    dataKey="revenue"
                    isAnimationActive={true}
                    animationDuration={900}
                  >
                    {data.by_source.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip
                    contentStyle={{
                      background: 'rgba(10, 14, 26, 0.95)',
                      border: '1px solid rgba(255,255,255,0.10)',
                      borderRadius: '10px'
                    }}
                  />
                </PieChart>
              </ResponsiveContainer>
            ) : (
              <div style={{ height: 320, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#8B92A8', border: '1px dashed rgba(255,255,255,0.12)', borderRadius: '12px' }}>
                No source breakdown yet.
              </div>
            )}
          </div>
        </div>
      );
    }

    function KpiCard({ label, value, sub, foot, accent }) {
      return (
        <div style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: '14px', padding: '18px' }}>
          <div style={{ color: '#8B92A8', fontSize: '13px', marginBottom: '8px' }}>{label}</div>
          <div style={{ fontSize: '32px', fontWeight: 900, marginBottom: '6px' }}>{value}</div>
          <div style={{ color: '#8B92A8', fontSize: '12px', marginBottom: '10px' }}>{sub}</div>
          <div style={{ color: accent || '#00FF88', fontSize: '13px', fontWeight: 800 }}>{foot}</div>
        </div>
      );
    }

    // =========================
    // Insights View
    // =========================
    function InsightsView({ insights }) {
      return (
        <div>
          <h2 style={{ fontSize: '24px', marginBottom: '18px' }}>AI-Powered Insights</h2>

          {(!insights || insights.length === 0) ? (
            <div style={{ textAlign: 'center', padding: '60px', color: '#8B92A8' }}>
              No insights available yet. Check back soon!
            </div>
          ) : (
            <div style={{ display: 'grid', gap: '16px' }}>
              {insights.map(insight => (
                <div
                  key={insight.id}
                  style={{
                    background: 'rgba(255,255,255,0.03)',
                    border: `1px solid ${insight.type === 'opportunity' ? '#00D9FF' : insight.type === 'warning' ? '#FFB800' : '#00FF88'}`,
                    borderLeft: `4px solid ${insight.type === 'opportunity' ? '#00D9FF' : insight.type === 'warning' ? '#FFB800' : '#00FF88'}`,
                    borderRadius: '14px',
                    padding: '18px'
                  }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px', gap: '12px', flexWrap: 'wrap' }}>
                    <div>
                      <span style={{
                        background: `${insight.type === 'opportunity' ? 'rgba(0,217,255,0.10)' : insight.type === 'warning' ? 'rgba(255,184,0,0.10)' : 'rgba(0,255,136,0.10)'}`,
                        color: `${insight.type === 'opportunity' ? '#00D9FF' : insight.type === 'warning' ? '#FFB800' : '#00FF88'}`,
                        padding: '4px 10px',
                        borderRadius: '999px',
                        fontSize: '12px',
                        fontWeight: 900,
                        textTransform: 'uppercase'
                      }}>
                        {insight.type}
                      </span>
                      <span style={{ marginLeft: '10px', color: '#8B92A8', fontSize: '12px', fontWeight: 700 }}>
                        {insight.impact} IMPACT
                      </span>
                    </div>

                    <div style={{ textAlign: 'center', padding: '8px 12px', background: 'rgba(0,217,255,0.10)', borderRadius: '12px', border: '1px solid rgba(0,217,255,0.25)' }}>
                      <div style={{ fontSize: '18px', fontWeight: 900, color: '#00D9FF' }}>{insight.confidence}%</div>
                      <div style={{ fontSize: '10px', color: '#8B92A8', fontWeight: 800 }}>CONFIDENCE</div>
                    </div>
                  </div>

                  <h4 style={{ fontSize: '18px', marginBottom: '8px' }}>{insight.title}</h4>
                  <p style={{ color: '#8B92A8', lineHeight: 1.6 }}>{insight.description}</p>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // =========================
    // Clients View
    // =========================
    function ClientsView({ clients }) {
      return (
        <div>
          <h2 style={{ fontSize: '24px', marginBottom: '18px' }}>Client Portfolio</h2>

          {(!clients || clients.length === 0) ? (
            <div style={{ textAlign: 'center', padding: '60px', color: '#8B92A8' }}>
              No clients yet. Start adding clients to track their performance!
            </div>
          ) : (
            <div style={{ display: 'grid', gap: '14px' }}>
              {clients.map(client => (
                <div
                  key={client.id}
                  style={{
                    background: 'rgba(255,255,255,0.03)',
                    border: '1px solid rgba(255,255,255,0.08)',
                    borderRadius: '14px',
                    padding: '18px'
                  }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '14px', gap: '12px', flexWrap: 'wrap' }}>
                    <div>
                      <h4 style={{ fontSize: '18px', marginBottom: '4px' }}>{client.company_name || client.name}</h4>
                      <span style={{ color: '#8B92A8', fontSize: '14px' }}>{client.industry}</span>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <div style={{ fontSize: '22px', fontWeight: 900, marginBottom: '4px' }}>
                        ${Number(client.mrr || client.monthlyRevenue || 0).toLocaleString()}
                      </div>
                      <div style={{ fontSize: '12px', color: '#8B92A8' }}>Monthly Recurring</div>
                    </div>
                  </div>

                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                    <div>
                      <div style={{ fontSize: '12px', color: '#8B92A8', marginBottom: '8px' }}>Status</div>
                      <span style={{
                        background: (client.status || "").toLowerCase() === 'active' ? 'rgba(0,255,136,0.10)' : 'rgba(255,184,0,0.10)',
                        color: (client.status || "").toLowerCase() === 'active' ? '#00FF88' : '#FFB800',
                        padding: '4px 10px',
                        borderRadius: '999px',
                        fontSize: '12px',
                        fontWeight: 900,
                        textTransform: 'uppercase'
                      }}>
                        {client.status || "active"}
                      </span>
                    </div>
                    <div>
                      <div style={{ fontSize: '12px', color: '#8B92A8', marginBottom: '8px' }}>Health Score</div>
                      <div style={{ fontSize: '18px', fontWeight: 900, color: '#00FF88' }}>
                        {Math.round(Number(client.health_score || client.healthScore || 85))}%
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // =========================
    // App
    // =========================
    function App() {
      const [token, setToken] = useState(localStorage.getItem('token'));
      const [user, setUser] = useState(JSON.parse(localStorage.getItem('user') || 'null'));

      const handleLogin = (newToken, newUser) => {
        setToken(newToken);
        setUser(newUser);
        localStorage.setItem('token', newToken);
        localStorage.setItem('user', JSON.stringify(newUser));
      };

      const handleLogout = () => {
        setToken(null);
        setUser(null);
        localStorage.removeItem('token');
        localStorage.removeItem('user');
      };

      if (!token) return <LoginPage onLogin={handleLogin} />;
      return <Dashboard token={token} user={user} onLogout={handleLogout} />;
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
